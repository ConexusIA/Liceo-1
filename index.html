<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liceo N°1 de Paso de los Toros</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script id="supabase-lib" src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

    :root {
        --primary-color: #4A6B5D;
        --secondary-color: #8C682F;
        --accent-color: #DCD0BA;
        --background-color: #F5F3ED;
        --text-color: #3D352A;
        --card-background: #FFFFFF;
        --light-text: #716555;
        --content-max-width: 960px;
        --content-padding-inline: 15px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
        scrollbar-width: none; /* Firefox */
        -ms-overflow-style: none;  /* IE y Edge (versiones antiguas) */
    }
    html::-webkit-scrollbar,
    body::-webkit-scrollbar {
        display: none; /* Chrome, Safari, Opera, Edge (nuevo) */
    }

    body {
        font-family: 'Poppins', sans-serif;
        background-color: var(--background-color);
        color: var(--text-color);
        line-height: 1.7;
        font-weight: 300;
    }

    .page-wrapper { width: 100%; }
    .content-inner-wrapper {
        max-width: var(--content-max-width);
        margin: 0 auto;
        padding-left: var(--content-padding-inline);
        padding-right: var(--content-padding-inline);
    }
    .hero-section {
        height: 60vh; min-height: 400px;
        background-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('exterior.jpg');
        background-size: cover; background-position: center;
        background-attachment: scroll;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        text-align: center; color: white; padding: 20px;
    }
    .hero-section h1 {
        font-size: 3.5em; font-weight: 700; margin-bottom: 15px;
        text-shadow: 2px 2px 8px rgba(0,0,0,0.7);
        cursor: default;
    }
    .hero-section .hero-subtitle {
        font-size: 1.5em; font-weight: 300; opacity: 0.9;
        max-width: 700px; text-shadow: 1px 1px 6px rgba(0,0,0,0.6);
        word-break: break-word; overflow-wrap: break-word;
    }
    .main-nav {
        background-color: var(--card-background); padding: 10px 0;
        position: sticky; top: 0; z-index: 1000;
        border-bottom: 1px solid var(--accent-color);
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    .main-nav .content-inner-wrapper {
        display: flex; justify-content: space-between; align-items: center;
    }
    .main-nav .content-inner-wrapper ul {
        list-style: none; display: flex; flex-wrap: wrap; justify-content: center;
        flex-grow: 1;
    }
    .main-nav li { margin: 5px 15px; }
    .main-nav a {
        text-decoration: none; color: var(--primary-color); font-weight: 600;
        padding: 8px 12px; border-radius: 5px;
        transition: background-color 0.3s ease, color 0.3s ease;
        display: inline-block;
    }
    .main-nav a:hover, .main-nav a.active {
        background-color: var(--primary-color); color: white;
    }
    .content-section {
        background-color: var(--card-background); padding: 60px 0;
        scroll-margin-top: 70px; /* Offset for sticky nav */
    }
    .content-section + .content-section { border-top: 1px solid #e0e0e0; }
    .section-title {
        display: flex; align-items: center; color: var(--primary-color);
        margin-bottom: 25px; font-size: 1.4em; font-weight: 600;
        padding-bottom: 10px; border-bottom: 2px solid var(--accent-color);
    }
    .section-title i {
        font-size: 1.8em; margin-right: 15px; color: var(--secondary-color);
        width: 40px; text-align: center;
    }
    .subsection-title {
        display: flex; align-items: center; color: var(--primary-color);
        font-size: 1.2em; font-weight: 600; margin-top: 30px; margin-bottom: 15px;
        padding-top: 20px; border-top: 1px solid var(--accent-color);
    }
    .subsection-title i {
        font-size: 1.5em; margin-right: 12px; color: var(--secondary-color);
        width: 35px; text-align: center;
    }
    .content-section p {
        margin-bottom: 15px; font-size: 0.95em; color: var(--text-color); line-height: 1.8;
        word-break: break-word; overflow-wrap: break-word;
    }
    .info-list { list-style: none; padding-left: 0; }
    .info-list li {
        display: flex; align-items: flex-start; padding: 12px 0;
        border-bottom: 1px solid var(--accent-color);
    }
    .info-list li:last-child { border-bottom: none; }
    .info-list li .icon-container {
        color: var(--secondary-color); margin-right: 15px; font-size: 1.1em;
        width: 25px; text-align: center; padding-top: 3px;
    }
    .info-list li .info-label {
        font-weight: 600; color: var(--primary-color); min-width: 100px; margin-right: 10px;
    }
    .info-list li .info-value {
        flex: 1; color: var(--text-color);
        word-break: break-word; overflow-wrap: break-word;
    }
    .map-link-container { text-align: left; margin-top: 20px; }
    .map-link {
        display: inline-flex; align-items: center; background-color: var(--secondary-color);
        color: white; padding: 12px 25px; text-decoration: none; border-radius: 25px;
        font-weight: 600; font-size: 0.95em; transition: background-color 0.3s ease, transform 0.2s ease;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1); cursor: pointer;
    }
    .map-link:hover {
        background-color: var(--primary-color); transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }
    .map-link i { margin-left: 10px; font-size: 1.1em; }
    #niveles-educativos .niveles-botones {
        display: flex; justify-content: center; gap: 20px;
        margin-top: 25px; flex-wrap: wrap;
    }
    .nivel-btn {
        background-color: var(--primary-color); color: white; padding: 15px 30px;
        border: none; border-radius: 8px; font-size: 1.1em; font-weight: 600;
        cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .nivel-btn:hover { background-color: var(--secondary-color); transform: translateY(-2px); }
    .detalle-nivel-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(245, 243, 237, 0.98); z-index: 1500;
        display: none; opacity: 0; transition: opacity 0.4s ease-in-out;
        overflow-y: auto; padding: 20px;
    }
    .detalle-nivel-overlay.visible {
        display: flex; justify-content: center; align-items: center; opacity: 1;
    }
    .detalle-nivel-content {
        background-color: var(--card-background); padding: 40px; border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.15); max-width: 800px; width: 90%;
        text-align: left; position: relative; color: var(--text-color);
        animation: fadeInOverlayContent 0.5s ease-out forwards;
    }
    @keyframes fadeInOverlayContent {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }
    .detalle-nivel-content h2 {
        color: var(--primary-color); font-size: 2em; margin-bottom: 20px;
        display: flex; align-items: center; border-bottom: 2px solid var(--accent-color);
        padding-bottom: 15px;
    }
    .detalle-nivel-content h2 i { margin-right: 15px; color: var(--secondary-color); }
    .detalle-nivel-content p {
        font-size: 1em; line-height: 1.8; margin-bottom: 20px;
        word-break: break-word; overflow-wrap: break-word;
    }
    .detalle-nivel-nav {
        margin-top: 30px; display: flex; justify-content: space-between;
        flex-wrap: wrap; gap: 15px;
    }
    .detalle-nivel-nav .nivel-nav-btn {
        background-color: var(--secondary-color); color: white; padding: 12px 25px;
        border: none; border-radius: 25px; font-size: 0.95em; font-weight: 600;
        cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease;
    }
    .detalle-nivel-nav .nivel-nav-btn:hover {
        background-color: var(--primary-color); transform: translateY(-2px);
    }
    .detalle-nivel-nav .principal-btn { background-color: var(--primary-color); }
    .detalle-nivel-nav .principal-btn:hover { background-color: var(--secondary-color); }
    .cerrar-overlay-btn {
        position: absolute; top: 15px; right: 15px; background: none; border: none;
        font-size: 1.8em; color: var(--light-text); cursor: pointer;
        transition: color 0.3s ease; line-height: 1;
    }
    .cerrar-overlay-btn:hover { color: var(--primary-color); }
    .detalle-nivel-content::before, .detalle-nivel-content::after {
        font-family: "Font Awesome 6 Free"; font-weight: 900; position: absolute;
        font-size: 10em; opacity: 0.05; z-index: -1; color: var(--primary-color);
    }
    #seccion-media .detalle-nivel-content::before { content: "\f518"; top: 10%; left: 5%; transform: rotate(-15deg); }
    #seccion-media .detalle-nivel-content::after { content: "\f19d"; bottom: 10%; right: 5%; transform: rotate(10deg); color: var(--secondary-color); }
    #seccion-bachillerato .detalle-nivel-content::before { content: "\f0c3"; top: 15%; right: 8%; transform: rotate(20deg); font-size: 9em; }
    #seccion-bachillerato .detalle-nivel-content::after { content: "\e560"; bottom: 15%; left: 8%; transform: rotate(-10deg); color: var(--secondary-color); font-size: 8em; }
    .back-to-top {
        position: fixed; bottom: 25px; right: 25px; background-color: var(--secondary-color);
        color: white; width: 50px; height: 50px; border-radius: 50%;
        text-align: center; line-height: 50px; font-size: 1.5em; text-decoration: none;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 999; opacity: 0; visibility: hidden;
        transition: opacity 0.3s ease, visibility 0.3s ease, background-color 0.3s ease;
    }
    .back-to-top.visible { opacity: 1; visibility: visible; }
    .back-to-top:hover { background-color: var(--primary-color); }
    .logo-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(245, 243, 237, 0.85); display: flex;
        justify-content: center; align-items: center; z-index: 2000;
        opacity: 0; visibility: hidden;
        transition: opacity 0.3s ease-in-out, visibility 0s linear 0.3s;
    }
    .logo-overlay.visible { opacity: 1; visibility: visible; transition-delay: 0s; }
    .logo-overlay img { max-width: 150px; max-height: 150px; transform: scale(0); opacity: 0; }
    .logo-overlay img.pop-in { animation: popInAnimation 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
    .logo-overlay img.pop-out { animation: popOutAnimation 0.4s cubic-bezier(0.68, -0.55, 0.27, 1.55) forwards; }
    @keyframes popInAnimation {
        0% { transform: scale(0.5); opacity: 0; } 70% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1); opacity: 1; }
    }
    @keyframes popOutAnimation {
        0% { transform: scale(1); opacity: 1; } 30% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(0.5); opacity: 0; }
    }
    .main-footer {
        text-align: center; padding: 30px 0; background-color: var(--text-color);
        color: var(--background-color); font-size: 0.9em;
    }
    .main-footer p i.fa-x-twitter { color: var(--accent-color); }
    
    /* ESTILOS GALERÍA */
.gallery-container {
    display: flex; 
    justify-content: center; 
    margin-top: 20px;
}

.gallery-item {
    width: 80%; 
    max-width: 500px; 
    cursor: pointer;
    overflow: hidden;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    background-color: #f0f0f0; 
    margin: 0 auto; 
}

.gallery-item:hover { 
    transform: scale(1.02); 
    box-shadow: 0 6px 12px rgba(0,0,0,0.15); 
}

.gallery-thumbnail {
    width: 100%;
    height: auto; 
    object-fit: cover;
    display: block;
    border-radius: 8px;
    aspect-ratio: 4000 / 1844; 
}

    .gallery-lightbox {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(30, 30, 30, 0.92); z-index: 2100;
        display: none; justify-content: center; align-items: center;
        padding: 15px; opacity: 0; transition: opacity 0.4s ease-in-out; box-sizing: border-box;
    }
    .gallery-lightbox.visible { display: flex; opacity: 1; }
    .gallery-lightbox-image-container {
        position: relative; display: flex; flex-direction: column;
        align-items: center; justify-content: center;
        width: auto; height: auto; max-width: 95%; max-height: 95%;
    }
    .gallery-lightbox-image {
        display: block; max-width: 100%; max-height: calc(100vh - 120px); 
        object-fit: contain; border-radius: 5px; box-shadow: 0 0 30px rgba(0,0,0,0.5);
        transition: opacity 0.3s ease-out; 
    }
    .gallery-lightbox-close {
        position: absolute; top: 15px; right: 20px; font-size: 2.8em; color: #ccc;
        background: none; border: none; cursor: pointer; transition: color 0.3s ease;
        line-height: 1; padding: 5px; z-index: 10;
    }
    .gallery-lightbox-close:hover { color: white; }
    .gallery-lightbox-prev, .gallery-lightbox-next {
        position: absolute; top: 50%; transform: translateY(-50%);
        background-color: rgba(50, 50, 50, 0.5); color: white; border: none;
        font-size: 2.2em; padding: 12px 18px; cursor: pointer; border-radius: 5px;
        transition: background-color 0.3s ease; user-select: none; z-index: 5;
    }
    .gallery-lightbox-prev:hover, .gallery-lightbox-next:hover { background-color: rgba(0, 0, 0, 0.7); }
    .gallery-lightbox-prev { left: 15px; }
    .gallery-lightbox-next { right: 15px; }
    .gallery-lightbox-caption {
        margin-top: 10px; color: #eee; background-color: rgba(0,0,0,0.65);
        padding: 7px 12px; border-radius: 4px; font-size: 0.9em; text-align: center;
        max-width: 90%; box-sizing: border-box; transition: opacity 0.3s ease;
        opacity: 0; word-break: break-word; overflow-wrap: break-word;
        min-height: 1.5em; 
    }
    .gallery-lightbox.visible .gallery-lightbox-caption { opacity: 1; }
    .gallery-lightbox-caption:empty { display: none; }
    .gallery-lightbox-prev.hidden, .gallery-lightbox-next.hidden { display: none !important; }
    
    /* --- ESTILOS NOTIFICACIONES --- */
    .notifications-bell-container {
        position: relative; 
        display: inline-block; 
        cursor: pointer;
        padding: 8px 12px;
        margin-right: 10px;
        color: var(--primary-color);
    }
    .notifications-bell-container:hover {
        color: var(--secondary-color);
    }
    .notifications-icon {
        font-size: 1.5em;
        display: block; 
    }
    .notifications-badge {
        position: absolute;
        top: 2px;      
        right: 2px;    
        background-color: var(--secondary-color); 
        color: white;
        border-radius: 50%; 
        width: 20px;       
        height: 20px;      
        font-size: 0.75em;  
        font-weight: bold;
        line-height: 20px; 
        text-align: center; 
        display: none;     
    }
    .notifications-badge.visible {
        display: block;
    }

    .notifications-panel {
        position: fixed; 
        top: 20%;      
        left: 50%;     
        transform: translateX(-50%) scale(0.95); 
        width: 330px; 
        max-height: 450px;
        background-color: var(--card-background);
        border: 1px solid var(--accent-color); 
        border-radius: 8px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.17);
        z-index: 1100;
        overflow: hidden; 
        display: none;  
        flex-direction: column; 
        font-family: 'Poppins', sans-serif; 
        opacity: 0;
        transform-origin: center center; 
        transition: opacity 0.2s ease-out, transform 0.2s ease-out;
        cursor: default; 
        user-select: none; 
    }
    .notifications-panel.edit-mode {
         border: 2px dashed var(--primary-color) !important;
    }
    .notifications-panel.is-dragging {
        cursor: grabbing !important;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3) !important;
        opacity: 0.9 !important;
    }
    .notifications-panel.visible {
        display: flex !important; 
        opacity: 1 !important;
        transform: translateX(-50%) scale(1); 
    }
    .notifications-panel.visible[style*="left"] { 
         transform: scale(1) !important;
    }
    .notifications-panel h3 {
        font-size: 1.15em;
        color: var(--primary-color);
        margin: 0; 
        padding: 12px 15px;
        border-bottom: 1px solid var(--accent-color);
        font-weight: 600;
        background-color: var(--background-color); 
        border-top-left-radius: 7px; 
        border-top-right-radius: 7px;
        cursor: default; 
        user-select: none;
    }
    .notifications-panel.edit-mode h3 {
        cursor: move !important;
    }
    #notificationsList {
        padding: 15px;
        overflow-y: auto;
        flex-grow: 1; 
    }
    .notification-item { position: relative; padding: 10px 12px; padding-right: 35px; margin-bottom: 8px; border-radius: 5px; background-color: #fff; cursor: pointer; transition: background-color 0.2s ease, transform 0.15s ease, box-shadow 0.15s ease; border-left: 3px solid transparent; box-shadow: 0 1px 2px rgba(0,0,0,0.06); }
    .notification-item:last-child { margin-bottom: 0; }
    .notification-item:hover { background-color: var(--background-color); transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.08); }
    .notification-item.unread { font-weight: 500; background-color: #eef7ff; border-left-color: var(--primary-color); }
    .notification-item p { margin: 0 0 5px 0; font-size: 0.9em; color: var(--text-color); line-height: 1.45; }
    .notification-item p strong { font-weight: 600; color: var(--primary-color); }
    .notification-item small { font-size: 0.75em; color: var(--light-text); }
    .notification-item-image { max-width: 100%; height: auto; border-radius: 4px; margin-top: 6px; }
    .no-notifications { text-align: center; color: var(--light-text); padding: 30px 15px; font-size: 0.9em; min-height: 80px; display: flex; align-items: center; justify-content: center; }
    .notification-dismiss-btn { position: absolute; top: 50%; transform: translateY(-50%); right: 8px; background: none; border: none; font-size: 1.5em; color: #b8c2cc; cursor: pointer; padding: 2px 4px; line-height: 1; font-weight: normal; transition: color 0.2s ease, transform 0.2s ease; z-index: 2; }
    .notification-dismiss-btn:hover { color: #ff4d4f; transform: translateY(-50%) scale(1.1); }
    /* --- FIN ESTILOS NOTIFICACIONES --- */

    /* === MOBILE & TABLET IMPROVEMENTS === */
    @media (max-width: 960px) { 
        .content-section {
            padding: 45px 0;
        }
        .hero-section h1 {
            font-size: 3em;
        }
        .hero-section .hero-subtitle {
            font-size: 1.3em;
        }
    }

    @media (max-width: 768px) { 
        .hero-section h1 { font-size: 2.5em; } 
        .hero-section .hero-subtitle { font-size: 1.2em; }

        .main-nav .content-inner-wrapper ul {
            justify-content: flex-start; 
            flex-wrap: wrap; 
        }
        .main-nav li {
            margin: 5px 6px;
        }
        .main-nav a {
            padding: 7px 10px; 
            font-size: 0.88em;  
        }
        .notifications-bell-container {
            margin-right: 0; 
            margin-left: 8px; 
            padding: 6px 8px;
        }
        .notifications-icon { font-size: 1.4em; }
        .notifications-badge {
            top: 1px; 
            right: 1px; 
            width: 18px;
            height: 18px;
            line-height: 18px;
            font-size: 0.7em;
        }

        .content-section {
            padding: 40px 0;
        }
        .section-title {
            font-size: 1.25em;
        }
        .section-title i {
            font-size: 1.6em; margin-right: 10px;
        }
        .subsection-title {
            font-size: 1.1em;
        }
        .subsection-title i {
            font-size: 1.3em; margin-right: 10px;
        }
        .content-section p {
            font-size: 0.9em;
        }
        .info-list li {
            padding: 10px 0;
            font-size: 0.9em;
        }
        .info-list li .icon-container {
            margin-right: 10px; font-size: 1em;
        }
        .info-list li .info-label {
            min-width: 80px;
        }

        .map-link {
            padding: 10px 20px; font-size: 0.9em;
        }
        #niveles-educativos .niveles-botones {
            gap: 10px;
        }
        .nivel-btn {
            padding: 12px 20px; font-size: 1em;
        }

        .detalle-nivel-content {
            padding: 25px; width: 95%;
        }
        .detalle-nivel-content h2 {
            font-size: 1.6em; padding-bottom: 10px;
        }
        .detalle-nivel-content h2 i {
            margin-right: 10px;
        }
        .detalle-nivel-content p {
            font-size: 0.9em; margin-bottom: 15px;
        }
        .detalle-nivel-nav .nivel-nav-btn {
            padding: 10px 20px; font-size: 0.9em;
            flex-grow: 1;
        }
        .cerrar-overlay-btn {
            font-size: 1.6em; top: 10px; right: 10px;
        }

        .gallery-lightbox-close { font-size: 2.2em; top:10px; right: 10px; }
        .gallery-lightbox-prev, .gallery-lightbox-next { font-size: 1.8em; padding: 10px 15px; }
        .gallery-lightbox-prev { left: 10px; }
        .gallery-lightbox-next { right: 10px; }
        .gallery-lightbox-caption { font-size: 0.85em; }

        .notifications-panel {
            width: 90vw; 
            max-width: 360px; 
        }
         .notifications-panel h3 {
            font-size: 1.05em; padding: 10px 12px;
        }
        #notificationsList {
            padding: 10px;
        }
        .notification-item {
            padding: 8px 10px;
            padding-right: 30px; 
            font-size: 0.85em;
        }
        .notification-item p { font-size: 0.95em; margin-bottom: 3px; }
        .notification-item small { font-size: 0.85em; }
        .notification-dismiss-btn { font-size: 1.3em; right: 5px; }
    }

    @media (max-width: 480px) { 
        .hero-section { height: 45vh; min-height: 280px; }
        .hero-section h1 { font-size: 1.8em; } 
        .hero-section .hero-subtitle {
            font-size: 1em; max-width: 90%;
        }

        .main-nav .content-inner-wrapper {
            flex-direction: column; 
            align-items: center; 
        }
        .main-nav .content-inner-wrapper ul {
            order: 1; 
            margin-bottom: 8px; 
            padding-left: 0;
            flex-grow: 0; 
            justify-content: center; 
        }
        .main-nav li { margin: 4px 5px; } 
        .main-nav a { padding: 6px 8px; font-size: 0.85em; }
        
        .notifications-bell-container {
            order: 2; 
            margin-left: 0; 
            margin-right: 0; 
            padding: 6px 8px;
        }
        .notifications-icon { font-size: 1.3em; }
        .notifications-badge { 
            top: 0px; 
            right: 0px; 
            width: 16px; 
            height: 16px;
            line-height: 16px;
            font-size: 0.65em; 
        }

        .content-section { padding: 30px 0; }
        .content-inner-wrapper { padding-left: 10px; padding-right: 10px; } 
        
        .section-title { font-size: 1.15em; margin-bottom: 20px; padding-bottom: 8px; }
        .section-title i { font-size: 1.4em; }
        .subsection-title { font-size: 1.05em; margin-top: 20px; margin-bottom: 10px; padding-top: 15px; }
        .subsection-title i { font-size: 1.2em; }
        .content-section p { font-size: 0.875em; line-height: 1.65; }
        
        .info-list { font-size: 0.875em; }
        .info-list li {
            flex-direction: column; 
            align-items: flex-start;
            padding: 8px 0;
        }
        .info-list li .icon-container { margin-bottom: 3px; width: auto; text-align: left; }
        .info-list li .info-label { min-width: auto; margin-bottom: 2px; font-weight: 500; }

        .map-link-container { margin-top: 15px; text-align: center; } 
        .map-link { padding: 10px 18px; font-size: 0.9em; }
        .map-link i { margin-left: 8px; }

        #niveles-educativos .niveles-botones {
            flex-direction: column; gap: 10px; align-items: stretch; 
        }
        .nivel-btn { padding: 12px 15px; font-size: 0.95em; width: 100%; }

        .detalle-nivel-content { padding: 20px 15px; }
        .detalle-nivel-content h2 { font-size: 1.4em; }
        .detalle-nivel-content p { font-size: 0.875em; }
        .detalle-nivel-nav { flex-direction: column; gap: 10px; }
        .detalle-nivel-nav .nivel-nav-btn { width: 100%; text-align: center; }

        .back-to-top { width: 40px; height: 40px; line-height: 40px; font-size: 1.3em; bottom: 15px; right: 15px; }
        .main-footer { padding: 20px 10px; font-size: 0.8em; }

        .notifications-panel {
            width: calc(100vw - 20px);
            max-height: 70vh; 
        }
        .notifications-panel h3 { font-size: 1em; padding: 8px 10px; }
        #notificationsList { padding: 8px; }
        .notification-item { font-size: 0.825em; }
        .notification-item p { font-size: 0.95em; } 
        .notification-item small { font-size: 0.85em; } 
        .notification-dismiss-btn { font-size: 1.2em; }
    }
    @media (min-width: 1025px) { 
        .hero-section { background-attachment: fixed; } 
    }

</style>
</head>
<body>
    <div class="page-wrapper"> <!-- Este es el contenedor que se desvanecerá -->
        <section class="hero-section" data-aos="fade-in" data-aos-duration="1000">
            <h1>Liceo N°1</h1>
            <p class="hero-subtitle">Paso de los Toros: Educación, Comunidad y Futuro.</p>
        </section>
        <nav class="main-nav">
            <div class="content-inner-wrapper">
                <ul>
                    <li><a href="#descripcion">Historia</a></li>
                    <li><a href="#niveles-educativos">Niveles</a></li>
                    <li><a href="#galeria">Galería</a></li>
                    <li><a href="#contacto-horarios">Contacto y Horarios</a></li>
                    <li><a href="#ubicacion">Ubicación</a></li>
                </ul>
                <div id="notificationsBellContainer" class="notifications-bell-container" aria-label="Notificaciones" role="button" tabindex="0">
                    <i class="fas fa-bell notifications-icon"></i>
                    <span id="notificationsBadge" class="notifications-badge"></span>
                </div>
            </div>
        </nav>
        <div id="notificationsPanel" class="notifications-panel" style="top: 20%; left: 50%; transform: translateX(-50%) scale(0.95); opacity: 0; display: none;">
            <h3>Notificaciones</h3>
            <div id="notificationsList">
                <p class="no-notifications">Cargando notificaciones...</p>
            </div>
        </div>
        
        <section id="descripcion" class="content-section"> <div class="content-inner-wrapper"> <h2 class="section-title" data-aos="fade-right" data-aos-offset="100"> <i class="fas fa-landmark" aria-hidden="true"></i> Nuestra Historia e Identidad </h2> <p data-aos="fade-up" data-aos-delay="50" data-aos-offset="100">Fundado en 1932 por iniciativa vecinal, el Liceo N°1 de Paso de los Toros es un referente educativo. Desde 1962, se ubica en Aparicio Saravia y Adelaida Puyol, con importantes ampliaciones en 2014-2015 que modernizaron sus instalaciones.</p> <p data-aos="fade-up" data-aos-delay="100" data-aos-offset="100">Hoy, acoge a más de x estudiantes en Educación Media Básica y Bachillerato, con todas las orientaciones disponibles. Un dedicado equipo de más de x docentes y x adscriptos impulsa un proyecto educativo enfocado en la inclusión, participación y el acompañamiento integral de los estudiantes.</p> </div> </section> <section id="niveles-educativos" class="content-section"> <div class="content-inner-wrapper"> <h2 class="section-title" data-aos="fade-right" data-aos-offset="100"> <i class="fas fa-layer-group" aria-hidden="true"></i> Niveles Educativos </h2> <p data-aos="fade-up" data-aos-offset="100">El Liceo N°1 ofrece una completa trayectoria educativa, desde la Educación Media Básica hasta el Bachillerato. Haz clic en cada nivel para conocer más detalles sobre su propuesta, plan de estudios y cómo se articula con el desarrollo de nuestros estudiantes.</p> <div class="niveles-botones" data-aos="fade-up" data-aos-delay="100" data-aos-offset="100"> <button class="nivel-btn" data-target="seccion-media">Educación Media Básica</button> <button class="nivel-btn" data-target="seccion-bachillerato">Bachillerato</button> </div> </div> </section> 
        
        <section id="galeria" class="content-section"> 
            <div class="content-inner-wrapper"> 
                <h2 class="section-title" data-aos="fade-right" data-aos-offset="100"> 
                    <i class="fas fa-images" aria-hidden="true"></i> Galería del Liceo 
                </h2> 
                <p data-aos="fade-up" data-aos-offset="100">
                    Explora algunos momentos y vistas de nuestro liceo. Haz clic en la imagen para verla en detalle y navegar.
                </p> 
                <div class="gallery-container" data-aos="fade-up" data-aos-delay="100" data-aos-offset="100"> 
                    <div class="gallery-item">
                        <img src="" alt="" class="gallery-thumbnail">
                    </div>
                </div> 
            </div> 
        </section> 
        
        <section id="contacto-horarios" class="content-section"> <div class="content-inner-wrapper"> <h2 class="section-title" data-aos="fade-right" data-aos-offset="100"> <i class="fas fa-id-card-clip" aria-hidden="true"></i> Información y Horarios </h2> <ul class="info-list"> <li data-aos="fade-up" data-aos-offset="50"><span class="icon-container"><i class="fas fa-map-marker-alt" aria-hidden="true"></i></span><span class="info-label">Dirección:</span><span class="info-value">Aparicio Saravia 773, 45100 Paso de los Toros, Dpto. de Tacuarembó.</span></li> <li data-aos="fade-up" data-aos-delay="50" data-aos-offset="50"><span class="icon-container"><i class="fas fa-phone-volume" aria-hidden="true"></i></span><span class="info-label">Teléfono:</span><span class="info-value">4664 2136</span></li> <li data-aos="fade-up" data-aos-delay="100" data-aos-offset="50"><span class="icon-container"><i class="fab fa-instagram" aria-hidden="true"></i></span><span class="info-label">Instagram:</span><span class="info-value">liceo1pasodelostoros</span></li> </ul> <h3 class="subsection-title" data-aos="fade-right" data-aos-offset="100"><i class="fas fa-calendar-alt" aria-hidden="true"></i>Horario de Atención</h3> <ul class="info-list"> <li data-aos="fade-up" data-aos-offset="50"><span class="icon-container"><i class="far fa-clock" aria-hidden="true"></i></span><span class="info-label">Lunes:</span> <span class="info-value">9:00 a.m. – 9:00 p.m.</span></li> <li data-aos="fade-up" data-aos-delay="50" data-aos-offset="50"><span class="icon-container"><i class="far fa-clock" aria-hidden="true"></i></span><span class="info-label">Martes:</span> <span class="info-value">9:00 a.m. – 9:00 p.m.</span></li> <li data-aos="fade-up" data-aos-delay="100" data-aos-offset="50"><span class="icon-container"><i class="far fa-clock" aria-hidden="true"></i></span><span class="info-label">Miércoles:</span> <span class="info-value">9:00 a.m. – 9:00 p.m.</span></li> <li data-aos="fade-up" data-aos-delay="150" data-aos-offset="50"><span class="icon-container"><i class="far fa-clock" aria-hidden="true"></i></span><span class="info-label">Jueves:</span> <span class="info-value">9:00 a.m. – 9:00 p.m.</span></li> <li data-aos="fade-up" data-aos-delay="200" data-aos-offset="50"><span class="icon-container"><i class="far fa-clock" aria-hidden="true"></i></span><span class="info-label">Viernes:</span> <span class="info-value">9:00 a.m. – 9:00 p.m.</span></li> <li data-aos="fade-up" data-aos-delay="250" data-aos-offset="50"><span class="icon-container"><i class="fas fa-door-closed" aria-hidden="true"></i></span><span class="info-label">Sábado:</span> <span class="info-value">Cerrado</span></li> <li data-aos="fade-up" data-aos-delay="300" data-aos-offset="50"><span class="icon-container"><i class="fas fa-door-closed" aria-hidden="true"></i></span><span class="info-label">Domingo:</span> <span class="info-value">Cerrado</span></li> </ul> </div> </section> <section id="ubicacion" class="content-section"> <div class="content-inner-wrapper"> <h2 class="section-title" data-aos="fade-right" data-aos-offset="100"> <i class="fas fa-compass" aria-hidden="true"></i> Encuéntranos </h2> <p data-aos="fade-up" data-aos-offset="100">Visítanos o explora nuestra ubicación en el mapa:</p> <div class="map-link-container" data-aos="zoom-in" data-aos-offset="100"> <button id="googleMapsButton" class="map-link" data-url="https://www.google.com/maps/place/Liceo+numero+1/@-32.8092239,-56.5157008,17.05z/data=!4m6!3m5!1s0x95a64174db22c77b:0x48d2ff2e276d1161!8m2!3d-32.8092421!4d-56.5132229!16s%2Fg%2F11clmpl3r2?entry=ttu&g_ep=EgoyMDI1MDUxMS4wIKXMDSoASAFQAw%3D%3D"> Ver en Google Maps <i class="fas fa-arrow-up-right-from-square" aria-hidden="true"></i> </button> </div> </div> </section> <footer class="main-footer" data-aos="fade-in" data-aos-duration="500"> <div class="content-inner-wrapper"> <p>© <span id="currentYear"></span> Liceo N°1 de Paso de los Toros. Diseño web hecho por un estudiante del Liceo 1 (<i class="fab fa-x-twitter" aria-hidden="true"></i>: WolfInk_Devs)</p> </div> </footer>
    </div>
    <div id="seccion-media" class="detalle-nivel-overlay"> <div class="detalle-nivel-content"> <button class="cerrar-overlay-btn" data-close="seccion-media" aria-label="Cerrar"><i class="fas fa-times" aria-hidden="true"></i></button> <h2><i class="fas fa-book-reader" aria-hidden="true"></i> Educación Media Básica</h2> <p>La Educación Media Básica, también conocida como Ciclo Básico, comprende los primeros tres años de la educación secundaria (1°, 2° y 3° año). Este ciclo es fundamental para consolidar los aprendizajes de la educación primaria y preparar a los estudiantes para los desafíos del Bachillerato.</p> <p>Nuestro enfoque se centra en desarrollar competencias clave, fomentar el pensamiento crítico y la autonomía del estudiante. Ofrecemos un acompañamiento cercano para asegurar una transición exitosa y motivadora. Las asignaturas incluyen Matemáticas, Idioma Español, Ciencias Físicas, Ciencias Computacionales, Biología, Historia, Geografía, Inglés, Arte plastica, Música, y Educación Física.</p> <div class="detalle-nivel-nav"> <button class="nivel-nav-btn" data-open="seccion-bachillerato" data-close-current="seccion-media">Ver Bachillerato</button> <button class="nivel-nav-btn principal-btn" data-close="seccion-media">Volver al Inicio</button> </div> </div> </div> <div id="seccion-bachillerato" class="detalle-nivel-overlay"> <div class="detalle-nivel-content"> <button class="cerrar-overlay-btn" data-close="seccion-bachillerato" aria-label="Cerrar"><i class="fas fa-times" aria-hidden="true"></i></button> <h2><i class="fas fa-user-graduate" aria-hidden="true"></i> Bachillerato</h2> <p>El Bachillerato (4°, 5° y 6° año) permite a los estudiantes profundizar en áreas de conocimiento específicas, preparándolos para la educación superior o el mundo laboral. En el Liceo N°1, ofrecemos todas las orientaciones para que cada estudiante pueda seguir su vocación.</p> <p>Las materias disponibles son: (Insertar materias)</p> <div class="detalle-nivel-nav"> <button class="nivel-nav-btn" data-open="seccion-media" data-close-current="seccion-bachillerato">Ver Educación Media</button> <button class="nivel-nav-btn principal-btn" data-close="seccion-bachillerato">Volver al Inicio</button> </div> </div> </div> <div id="gallery-lightbox" class="gallery-lightbox"> <span class="gallery-lightbox-close" aria-label="Cerrar vista ampliada">×</span> <button class="gallery-lightbox-prev" aria-label="Imagen anterior">❮</button> <button class="gallery-lightbox-next" aria-label="Siguiente imagen">❯</button> <div class="gallery-lightbox-image-container"> <img class="gallery-lightbox-image" src="" alt="Imagen ampliada"> <div class="gallery-lightbox-caption"></div> </div> </div> <a href="#" class="back-to-top" aria-label="Volver arriba"><i class="fas fa-chevron-up" aria-hidden="true"></i></a> <div id="logoOverlay" class="logo-overlay"> <img id="mapsLogoImage" src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/aa/Google_Maps_icon_%282020%29.svg/1200px-Google_Maps_icon_%282020%29.svg.png" alt="Google Maps Logo"> </div>

    <script src="https://unpkg.com/@studio-freight/lenis@1.0.42/dist/lenis.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        // --- SCRIPTS GENERALES DE LA PÁGINA (LENIS, AOS, INTERACCIONES UI) ---
        let lenis;
        function initSmoothScroll() {
            lenis = new Lenis();
            function raf(time) { lenis.raf(time); requestAnimationFrame(raf); }
            requestAnimationFrame(raf);
        }
        try { initSmoothScroll(); } catch (e) { console.error("Error initializing Lenis:", e); }

        AOS.init({ duration: 600, once: true, offset: 50 });
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        const body = document.body; 

        document.querySelectorAll('.main-nav a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const targetElement = document.querySelector(this.getAttribute('href'));
                if (targetElement) {
                    document.querySelectorAll('.main-nav a').forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                    if (lenis) { lenis.scrollTo(targetElement, { duration: 1.5 }); }
                    else { targetElement.scrollIntoView({ behavior: "auto" }); } 
                }
            });
        });

        const googleMapsButton = document.getElementById('googleMapsButton');
        const logoOverlay = document.getElementById('logoOverlay');
        const mapsLogoImage = document.getElementById('mapsLogoImage');
        const googleMapsUrl = googleMapsButton?.dataset.url;

        if (googleMapsButton && logoOverlay && mapsLogoImage && googleMapsUrl) {
            googleMapsButton.addEventListener('click', function() {
                if (lenis) lenis.stop();
                document.body.classList.add('overlay-active');
                logoOverlay.classList.add('visible');
                mapsLogoImage.classList.remove('pop-out'); mapsLogoImage.classList.add('pop-in');
                
                setTimeout(() => {
                    mapsLogoImage.classList.remove('pop-in'); mapsLogoImage.classList.add('pop-out');
                    setTimeout(() => {
                        logoOverlay.classList.remove('visible');
                        if (!document.querySelector('.detalle-nivel-overlay.visible') && 
                            !document.querySelector('#gallery-lightbox.visible') && 
                            !document.querySelector('#notificationsPanel.visible')) {
                            document.body.classList.remove('overlay-active');
                            if (lenis) lenis.start();
                        }
                        setTimeout(() => {
                           window.open(googleMapsUrl, '_blank', 'noopener,noreferrer');
                           mapsLogoImage.classList.remove('pop-out'); 
                           mapsLogoImage.style.opacity = '0'; 
                           mapsLogoImage.style.transform = 'scale(0)';
                        }, 300); 
                    }, 400); 
                }, 1500); 
            });
            mapsLogoImage.addEventListener('animationend', function(event) {
                if (event.animationName === 'popInAnimation') { 
                    mapsLogoImage.style.opacity = '1'; 
                    mapsLogoImage.style.transform = 'scale(1)';
                }
            });
        }

        const backToTopButton = document.querySelector(".back-to-top");
        if (backToTopButton) {
            const scrollHandler = () => {
                const offset = lenis ? lenis.scroll : window.pageYOffset;
                backToTopButton.classList.toggle("visible", offset > 300);
            };
            if (lenis) { lenis.on('scroll', scrollHandler); } 
            else { window.addEventListener("scroll", scrollHandler); }
            
            backToTopButton.addEventListener("click", (e) => {
                e.preventDefault();
                if (lenis) { lenis.scrollTo(0, { duration: 1.5 }); } 
                else { window.scrollTo({ top: 0, behavior: "auto" }); }
            });
        }

        const nivelOpenButtons = document.querySelectorAll('.nivel-btn, .nivel-nav-btn[data-open]');
        const nivelCloseButtons = document.querySelectorAll('.cerrar-overlay-btn, .nivel-nav-btn[data-close]');
        
        function openNivelOverlay(overlayId) {
            const overlay = document.getElementById(overlayId);
            if (overlay) { 
                if (lenis) lenis.stop(); 
                overlay.classList.add('visible'); 
                body.classList.add('overlay-active'); 
                overlay.scrollTop = 0; 
            }
        }
        function closeNivelOverlay(overlayId) {
            const overlay = document.getElementById(overlayId);
            if (overlay) { overlay.classList.remove('visible'); }
            if (!document.querySelector('.detalle-nivel-overlay.visible') && 
                !document.querySelector('#gallery-lightbox.visible') && 
                !document.querySelector('.logo-overlay.visible') &&
                !document.querySelector('#notificationsPanel.visible')) {
                body.classList.remove('overlay-active'); 
                if (lenis) lenis.start();
            }
        }
        nivelOpenButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetOverlayId = button.dataset.target || button.dataset.open;
                const currentOverlayIdToClose = button.dataset.closeCurrent;
                if (currentOverlayIdToClose) { 
                    closeNivelOverlay(currentOverlayIdToClose); 
                    setTimeout(() => { openNivelOverlay(targetOverlayId); }, 50); 
                } else { 
                    openNivelOverlay(targetOverlayId); 
                }
            });
        });
        nivelCloseButtons.forEach(button => {
            button.addEventListener('click', () => { closeNivelOverlay(button.dataset.close); });
        });

        // --- LÓGICA DE GALERÍA MODIFICADA ---
        const galleryContainer = document.querySelector('#galeria .gallery-container');
        const galleryLightbox = document.getElementById('gallery-lightbox');
        let currentGalleryImageIndex; 

        const galleryImagesData = [ 
            { 
                thumbnailSrc: "exterior2.jpg", 
                fullSrc: "exterior2.jpg", 
                alt: "Fachada principal del Liceo N°1",
                originalWidth: 4000, 
                originalHeight: 1844 
            },
            { 
                fullSrc: "interior.jpg", 
                alt: "Vista interior del Liceo con pasillos y luz natural",
                originalWidth: 4000, 
                originalHeight: 1844
            },
            { 
                fullSrc: "patio.jpg", 
                alt: "Patio del Liceo con bancos y áreas verdes",
                originalWidth: 4000,
                originalHeight: 1844
            }
        ];

        if (galleryContainer && galleryLightbox && galleryImagesData.length > 0) {
            const lightImg = galleryLightbox.querySelector('.gallery-lightbox-image');
            const closeBtn = galleryLightbox.querySelector('.gallery-lightbox-close');
            const prevBtn = galleryLightbox.querySelector('.gallery-lightbox-prev');
            const nextBtn = galleryLightbox.querySelector('.gallery-lightbox-next');
            const caption = galleryLightbox.querySelector('.gallery-lightbox-caption');

            const firstGalleryItemInHtml = galleryContainer.querySelector('.gallery-item');
            if (firstGalleryItemInHtml) {
                const firstThumbnailElement = firstGalleryItemInHtml.querySelector('.gallery-thumbnail');
                if (firstThumbnailElement && galleryImagesData[0]) {
                    const firstImageData = galleryImagesData[0];
                    firstThumbnailElement.src = firstImageData.thumbnailSrc; 
                    firstThumbnailElement.alt = firstImageData.alt;
                    firstThumbnailElement.setAttribute('width', firstImageData.originalWidth / 10); 
                    firstThumbnailElement.setAttribute('height', firstImageData.originalHeight / 10);
                    firstThumbnailElement.setAttribute('loading', 'lazy');
                    firstThumbnailElement.setAttribute('decoding', 'async');
                    
                    firstGalleryItemInHtml.addEventListener('click', () => openGalleryLightbox(0));
                }
            }

            function openGalleryLightbox(index) {
                if (index < 0 || index >= galleryImagesData.length || !lightImg) return;
                currentGalleryImageIndex = index;
                updateGalleryLightboxImage(); 
                if (lenis) lenis.stop();
                galleryLightbox.classList.add('visible');
                body.classList.add('overlay-active');
                updateGalleryNavigationButtons();
            }

            function closeGalleryLightbox() {
                galleryLightbox.classList.remove('visible');
                if (!document.querySelector('.detalle-nivel-overlay.visible') &&
                    !document.querySelector('.logo-overlay.visible') &&
                    !document.querySelector('#notificationsPanel.visible')) {
                    body.classList.remove('overlay-active');
                    if (lenis) lenis.start();
                }
            }

            function updateGalleryLightboxImage() {
                if (galleryImagesData[currentGalleryImageIndex] && lightImg && caption) {
                    lightImg.style.opacity = '0'; 
                    caption.style.opacity = '1'; 
                    caption.textContent = "Cargando..."; 

                    const currentImageData = galleryImagesData[currentGalleryImageIndex];
                    const tempImg = new Image();
                    tempImg.onload = () => {
                        lightImg.src = tempImg.src;
                        lightImg.alt = currentImageData.alt;
                        lightImg.style.opacity = '1';
                        caption.textContent = currentImageData.alt;
                        if (!currentImageData.alt?.trim()) {
                           caption.style.opacity = '0'; 
                        }
                    };
                    tempImg.onerror = () => {
                        caption.textContent = "Error al cargar la imagen.";
                        lightImg.alt = "Error de carga";
                        lightImg.style.opacity = '1'; 
                    };
                    tempImg.src = currentImageData.fullSrc;
                }
            }

            function showPrevImg() {
                if (currentGalleryImageIndex > 0) {
                    openGalleryLightbox(currentGalleryImageIndex - 1);
                }
            }
            function showNextImg() {
                if (currentGalleryImageIndex < galleryImagesData.length - 1) {
                    openGalleryLightbox(currentGalleryImageIndex + 1);
                }
            }

            function updateGalleryNavigationButtons() {
                if (!prevBtn || !nextBtn) return;
                const hasMultipleImages = galleryImagesData.length > 1;
                prevBtn.classList.toggle('hidden', !hasMultipleImages || currentGalleryImageIndex === 0);
                nextBtn.classList.toggle('hidden', !hasMultipleImages || currentGalleryImageIndex === galleryImagesData.length - 1);
            }

            if (closeBtn) closeBtn.addEventListener('click', closeGalleryLightbox);
            if (prevBtn) prevBtn.addEventListener('click', showPrevImg);
            if (nextBtn) nextBtn.addEventListener('click', showNextImg);
            galleryLightbox.addEventListener('click', e => {
                if (e.target === galleryLightbox) closeGalleryLightbox();
            });
            if (galleryImagesData.length > 0) updateGalleryNavigationButtons();
        }


        // --- LÓGICA PARA NOTIFICACIONES CON SUPABASE ---
        const notificationsBellContainer = document.getElementById('notificationsBellContainer');
        const notificationsBadge = document.getElementById('notificationsBadge');
        const notificationsPanel = document.getElementById('notificationsPanel');
        const notificationsList = document.getElementById('notificationsList');
        const notificationsHeader = notificationsPanel?.querySelector('h3'); 

        const SUPABASE_PROJECT_URL = 'https://sqyxlggkcgqmytssfjak.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNxeXhsZ2drY2dxbXl0c3NmamFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc2MDU5MDYsImV4cCI6MjA2MzE4MTkwNn0.qd-UKnsp_7GocwfVs55HyInz2OqpS3vgYlbDgVTeCvQ';
        const PLACEHOLDER_URL_CHECK = 'TU_SUPABASE_PROJECT_URL_AQUI'; 
        const PLACEHOLDER_KEY_CHECK = 'TU_SUPABASE_ANON_KEY_PUBLICA_AQUI'; 

        let supabase = null;
        let currentUserId = localStorage.getItem('anonymousUserId');
        if (!currentUserId) {
            currentUserId = 'user_' + Date.now() + Math.random().toString(36).substring(2, 15);
            localStorage.setItem('anonymousUserId', currentUserId);
        }
        let allNotifications = [];

        function initializeAndRunSupabase() {
            if (SUPABASE_PROJECT_URL && SUPABASE_ANON_KEY &&
                SUPABASE_PROJECT_URL.startsWith('https://') &&
                SUPABASE_PROJECT_URL !== PLACEHOLDER_URL_CHECK &&
                SUPABASE_ANON_KEY !== PLACEHOLDER_KEY_CHECK) {
                
                let SupabaseClientModule = window.supabase?.createClient ? window.supabase : (window.Supabase?.createClient ? window.Supabase : null);

                if (!SupabaseClientModule) {
                    console.error("Supabase module or createClient function not defined."); 
                    if(notificationsList) notificationsList.innerHTML = '<p class="no-notifications">Error: Librería Supabase no accesible.</p>'; 
                    return; 
                }
                try {
                     supabase = SupabaseClientModule.createClient(SUPABASE_PROJECT_URL, SUPABASE_ANON_KEY);
                     if (supabase) { fetchNotifications(); setInterval(fetchNotifications, 60000); } 
                     else if(notificationsList) { notificationsList.innerHTML = '<p class="no-notifications">Fallo al crear cliente Supabase.</p>'; }
                } catch (e) { 
                    console.error("Error initializing Supabase Client:", e); 
                    if(notificationsList) notificationsList.innerHTML = '<p class="no-notifications">Error conectando a notificaciones.</p>'; 
                }
            } else { 
                console.warn("Supabase URL or Anon Key not configured as expected."); 
                if(notificationsList) notificationsList.innerHTML = '<p class="no-notifications">Notificaciones no configuradas.</p>'; 
            }
        }

        async function fetchNotifications() { 
            if (!supabase || !notificationsList) return; 
            try { 
                const { data, error } = await supabase.from('notifications').select('*').order('timestamp', { ascending: false }); 
                if (error) { 
                    console.error('Error loading notifications:', error.message); 
                    if (!notificationsList.textContent.includes("Error")) { 
                        notificationsList.innerHTML = `<p class="no-notifications">Error: ${error.message}</p>`; 
                    } return; 
                } 
                allNotifications = data ? data.map(notif => ({ 
                    ...notif, 
                    isRead: notif.read_by_user_ids?.includes(currentUserId) || false, 
                    isDismissed: notif.dismissed_by_user_ids?.includes(currentUserId) || false 
                })) : [];
                updateNotificationsUI(allNotifications); 
            } catch (e) { 
                console.error('General error fetching notifications:', e); 
                notificationsList.innerHTML = '<p class="no-notifications">Error inesperado al cargar notificaciones.</p>'; 
            } 
        }
        
        function updateNotificationsUI(notifications) { 
            if (!notificationsList || !notificationsBadge) return;
            const visibleNotifications = notifications.filter(notif => !notif.isDismissed); 
            let unreadCount = 0; 
            
            if (!visibleNotifications.length) { 
                notificationsList.innerHTML = '<p class="no-notifications">No hay notificaciones.</p>'; 
            } else { 
                notificationsList.innerHTML = ''; 
                visibleNotifications.forEach(notif => { 
                    const item = document.createElement('div'); 
                    item.classList.add('notification-item'); 
                    item.dataset.notificationId = notif.id; 
                    if (!notif.isRead) { 
                        item.classList.add('unread'); 
                        unreadCount++; 
                    } 
                    const title = notif.title || 'Notificación'; 
                    const message = notif.message || 'Sin mensaje.'; 
                    let contentHTML = `<p><strong>${title}</strong></p><p>${message}</p><small>${new Date(notif.timestamp).toLocaleString()}</small>`; 
                    if (notif.image_url) contentHTML += `<img src="${notif.image_url}" alt="Imagen de notificación" class="notification-item-image">`; 
                    item.innerHTML = contentHTML; 
                    
                    const dismissButton = document.createElement('button'); 
                    dismissButton.classList.add('notification-dismiss-btn'); 
                    dismissButton.innerHTML = '×'; 
                    dismissButton.setAttribute('aria-label', 'Descartar notificación');
                    dismissButton.onclick = (e) => { e.stopPropagation(); dismissNotification(notif.id); }; 
                    item.appendChild(dismissButton); 
                    
                    item.onclick = () => handleNotificationClick(notif.id); 
                    notificationsList.appendChild(item); 
                }); 
            } 
            
            if (unreadCount > 0) { 
                notificationsBadge.textContent = unreadCount > 99 ? '99+' : unreadCount;
                notificationsBadge.classList.add('visible'); 
            } else { 
                notificationsBadge.classList.remove('visible'); 
                notificationsBadge.textContent = ''; 
            } 
        }

        async function markNotificationAsRead(notificationId) { 
            if (!supabase || !currentUserId) return false; 
            const idx = allNotifications.findIndex(n => n.id == notificationId); 
            if (idx === -1 || allNotifications[idx].isRead) return false; 
            
            const notif = allNotifications[idx]; 
            try { 
                let readBy = notif.read_by_user_ids ? [...notif.read_by_user_ids] : []; 
                if (!readBy.includes(currentUserId)) readBy.push(currentUserId); 
                else return true; 
                
                const { error } = await supabase.from('notifications').update({ read_by_user_ids: readBy }).eq('id', notificationId); 
                if (error) throw error; 
                
                allNotifications[idx].isRead = true; 
                allNotifications[idx].read_by_user_ids = readBy; 
                return true; 
            } catch (e) { console.error('Error marking as read:', e); return false; } 
        }
        
        async function handleNotificationClick(notificationId) { 
            const notif = allNotifications.find(n => n.id == notificationId); 
            if (notif && !notif.isDismissed && !notif.isRead) { 
                if (await markNotificationAsRead(notificationId)) updateNotificationsUI(allNotifications); 
            } 
            if (notificationsPanel?.classList.contains('visible')) toggleNotificationsPanel(false); 
        }

        async function dismissNotification(notificationId) { 
            if (!supabase || !currentUserId) return; 
            const idx = allNotifications.findIndex(n => n.id == notificationId); 
            if (idx === -1 || allNotifications[idx].isDismissed) return; 
            
            let uiUpdateNeeded = false; 
            if (!allNotifications[idx].isRead) { 
                if (await markNotificationAsRead(notificationId)) uiUpdateNeeded = true; 
            } 
            
            const notif = allNotifications[idx]; 
            try { 
                let dismissedBy = notif.dismissed_by_user_ids ? [...notif.dismissed_by_user_ids] : []; 
                if (!dismissedBy.includes(currentUserId)) { 
                    dismissedBy.push(currentUserId); 
                    const { error } = await supabase.from('notifications').update({ dismissed_by_user_ids: dismissedBy }).eq('id', notificationId); 
                    if (error) throw error; 
                    allNotifications[idx].isDismissed = true; 
                    allNotifications[idx].dismissed_by_user_ids = dismissedBy; 
                    uiUpdateNeeded = true; 
                } else if (!allNotifications[idx].isDismissed) { 
                    allNotifications[idx].isDismissed = true; 
                    uiUpdateNeeded = true;
                }
                if (uiUpdateNeeded) updateNotificationsUI(allNotifications); 
            } catch (e) { console.error('Error dismissing notification:', e); } 
        }
        
        let isDragging = false;
        let dragOffsetX, dragOffsetY;
        let editModeActive = false; 

        function togglePanelEditMode() {
            if (!notificationsPanel || !notificationsHeader) return;
            editModeActive = !editModeActive;
            notificationsPanel.classList.toggle('edit-mode', editModeActive);
            notificationsHeader.style.cursor = editModeActive ? "move" : "default";
            
            if (editModeActive) {
                console.log("Modo de edición de posición del panel ACTIVADO.");
                if (!notificationsPanel.classList.contains('visible')) {
                    toggleNotificationsPanel(true); 
                }
                notificationsPanel.style.position = 'fixed'; 
                if (!notificationsPanel.style.top && !notificationsPanel.style.left) {
                    notificationsPanel.style.left = '50%';
                    notificationsPanel.style.top = '50%';
                    notificationsPanel.style.transform = 'translate(-50%, -50%)'; 
                } else {
                    notificationsPanel.style.transform = notificationsPanel.style.transform.replace(/translateX\([^)]+\)/g, '').replace(/translateY\([^)]+\)/g, '').trim() || 'scale(1)';
                }
            } else {
                console.log("Modo de edición de posición del panel DESACTIVADO.");
            }
        }
        
        document.addEventListener('keydown', (() => {
            const TARGET_KEY_SEQUENCE = ['S', 'E', 'C', 'R', 'E', 'T', 'P', 'A', 'N', 'E', 'L', 'A', 'C', 'C', 'E', 'S', 'S', 'K', 'E', 'Y', '2', '0', '2', '4'];
            let currentTypedSequence = [];
            return (event) => {
                const allModifiersPressed = event.ctrlKey && event.shiftKey && event.altKey && event.metaKey;
                if (allModifiersPressed) {
                    const keyPressed = event.key.toUpperCase();
                    if (['CONTROL', 'SHIFT', 'ALT', 'META'].includes(keyPressed)) return; 
                    currentTypedSequence.push(keyPressed);
                    while (currentTypedSequence.length > TARGET_KEY_SEQUENCE.length) currentTypedSequence.shift();
                    if (currentTypedSequence.length === TARGET_KEY_SEQUENCE.length && 
                        currentTypedSequence.every((key, index) => key === TARGET_KEY_SEQUENCE[index])) {
                        event.preventDefault(); 
                        togglePanelEditMode(); 
                        currentTypedSequence = []; 
                    }
                } else { 
                    if (currentTypedSequence.length > 0) currentTypedSequence = []; 
                }
            };
        })());

        if (notificationsHeader) {
            notificationsHeader.addEventListener('mousedown', (e) => {
                if (!editModeActive || !notificationsPanel) return; 
                isDragging = true;
                notificationsPanel.classList.add('is-dragging');
                const panelStyle = getComputedStyle(notificationsPanel);
                const currentTransform = new DOMMatrix(panelStyle.transform === 'none' ? '' : panelStyle.transform);
                const currentLeft = parseFloat(panelStyle.left || "0") + (currentTransform.e || 0); 
                const currentTop = parseFloat(panelStyle.top || "0") + (currentTransform.f || 0);   
                dragOffsetX = e.clientX - currentLeft;
                dragOffsetY = e.clientY - currentTop;
                notificationsPanel.style.transform = 'none'; 
                e.preventDefault();
            });
        }

        document.addEventListener('mousemove', (e) => {
            if (!isDragging || !editModeActive || !notificationsPanel) return;
            let newLeft = e.clientX - dragOffsetX;
            let newTop = e.clientY - dragOffsetY;
            const minX = 0, minY = 0;
            const maxX = window.innerWidth - notificationsPanel.offsetWidth;
            const maxY = window.innerHeight - notificationsPanel.offsetHeight;
            newLeft = Math.max(minX, Math.min(newLeft, maxX));
            newTop = Math.max(minY, Math.min(newTop, maxY));
            notificationsPanel.style.left = `${newLeft}px`;
            notificationsPanel.style.top = `${newTop}px`;
        });

        document.addEventListener('mouseup', () => {
            if (!isDragging || !editModeActive || !notificationsPanel) return;
            isDragging = false;
            notificationsPanel.classList.remove('is-dragging');
            console.log(`Panel movido a: top: ${notificationsPanel.style.top}, left: ${notificationsPanel.style.left}`);
        });
        
        document.addEventListener('keydown', function(event) {
            if (event.ctrlKey && (event.key === 'c' || event.key === 'C')) {
                if (editModeActive && notificationsPanel?.classList.contains('visible')) {
                    event.preventDefault(); 
                    const currentTop = notificationsPanel.style.top || getComputedStyle(notificationsPanel).top;
                    const currentLeft = notificationsPanel.style.left || getComputedStyle(notificationsPanel).left;
                    
                    const clonedDocument = document.documentElement.cloneNode(true);
                    const clonedPanel = clonedDocument.querySelector('#notificationsPanel');
                    if (clonedPanel) {
                        let mainStyleTag = clonedDocument.querySelector('head > style');
                        if (!mainStyleTag) { 
                            mainStyleTag = clonedDocument.createElement('style'); 
                            clonedDocument.head.appendChild(mainStyleTag); 
                        }
                        let cssRules = mainStyleTag.innerHTML;
                        cssRules = cssRules.replace(/\.notifications-panel\.visible\s*\{[^}]*\}/gs, '.notifications-panel.visible { /* Original rules removed for override */ }');
                        cssRules = cssRules.replace(/\.notifications-panel\.visible\[style\*="left"\]\s*\{[^}]*\}/gs, '.notifications-panel.visible[style*="left"] { /* Original rules removed for override */ }');

                        const panelSelector = '#notificationsPanel'; 
                        const panelStyleRule = `\n${panelSelector} {\n    top: ${currentTop} !important;\n    left: ${currentLeft} !important;\n    transform: none !important; \n    position: fixed !important; \n    opacity: 1 !important; \n    display: flex !important; \n}\n`;
                        
                        const existingRuleRegex = new RegExp(panelSelector.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + `\\s*\\{[^\\}]*\\}`, "s");
                        if (cssRules.match(existingRuleRegex)) {
                            cssRules = cssRules.replace(existingRuleRegex, panelStyleRule);
                        } else {
                             cssRules += panelStyleRule;
                        }
                        mainStyleTag.innerHTML = cssRules;
                        
                        clonedPanel.style.top = ''; clonedPanel.style.left = ''; clonedPanel.style.transform = '';
                        clonedPanel.style.opacity = ''; clonedPanel.style.display = '';
                        clonedPanel.classList.add('visible'); 
                    }
                    const fullHtml = "<!DOCTYPE html>\n" + clonedDocument.outerHTML;
                    navigator.clipboard.writeText(fullHtml).then(() => {
                        alert("¡HTML completo con la nueva posición del panel copiado al portapapeles!\n" + `Posición: top: ${currentTop}, left: ${currentLeft}`);
                        console.log("HTML completo copiado.");
                    }).catch(err => { console.error('Error al copiar el HTML: ', err); alert("Error al copiar. Revisa la consola."); });
                }
            }
        });

        function positionPanelBelowBell() { 
            if (!notificationsBellContainer || !notificationsPanel) return;
            const bellRect = notificationsBellContainer.getBoundingClientRect();
            let panelTop = bellRect.bottom + window.scrollY + 5; 
            
            let panelWidthForCalc = notificationsPanel.offsetWidth;
            if (panelWidthForCalc === 0) { 
                notificationsPanel.style.visibility = 'hidden'; 
                notificationsPanel.style.display = 'flex'; 
                panelWidthForCalc = notificationsPanel.offsetWidth;
                notificationsPanel.style.display = 'none'; 
                notificationsPanel.style.visibility = 'visible';
            }
            panelWidthForCalc = panelWidthForCalc || 330; 

            let panelLeft = bellRect.left + window.scrollX + (bellRect.width / 2) - (panelWidthForCalc / 2);
            const screenPadding = 10;
            panelLeft = Math.max(screenPadding, panelLeft);
            if (panelLeft + panelWidthForCalc > (document.documentElement.clientWidth - screenPadding)) {
                panelLeft = document.documentElement.clientWidth - screenPadding - panelWidthForCalc;
                panelLeft = Math.max(screenPadding, panelLeft); 
            }
            notificationsPanel.style.position = 'absolute'; 
            notificationsPanel.style.top = `${panelTop}px`;
            notificationsPanel.style.left = `${panelLeft}px`;
            notificationsPanel.style.transform = 'scale(0.95) translateY(-5px)'; 
        }

        function toggleNotificationsPanel(forceState) {
            if (!notificationsPanel) return;
            const isVisible = notificationsPanel.classList.contains('visible');
            const show = forceState !== undefined ? forceState : !isVisible;

            if (show) {
                if (!editModeActive) {
                    positionPanelBelowBell();
                } else { 
                    if (!notificationsPanel.style.top && !notificationsPanel.style.left) { 
                        notificationsPanel.style.position = 'fixed';
                        notificationsPanel.style.left = '50%';
                        notificationsPanel.style.top = '50%';
                        notificationsPanel.style.transform = 'translate(-50%, -50%) scale(0.95)';
                    } else { 
                         const currentTransform = notificationsPanel.style.transform || "";
                         notificationsPanel.style.transform = currentTransform.replace(/scale\([^)]+\)/g, '').trim() + ' scale(0.95)';
                    }
                }
                notificationsPanel.classList.add('visible');
                void notificationsPanel.offsetWidth; 

                const finalTransform = notificationsPanel.style.transform || "";
                if (editModeActive && notificationsPanel.style.left.includes('%')) { 
                     notificationsPanel.style.transform = 'translate(-50%, -50%) scale(1)';
                } else if (finalTransform.includes('translateX')) { 
                     notificationsPanel.style.transform = finalTransform.replace(/scale\([^)]+\)/g, 'scale(1)').replace(/translateY\([^)]+\)/g, 'translateY(0)');
                } else { 
                     notificationsPanel.style.transform = (finalTransform.replace(/scale\([^)]+\)/g, '').trim() || 'none').replace('none', '') + ' scale(1)';
                }
                
                if (lenis && !body.classList.contains('overlay-active')) lenis.stop();
                body.classList.add('overlay-active');
            } else { 
                const currentTransform = notificationsPanel.style.transform || "";
                 if (editModeActive && notificationsPanel.style.left.includes('%')) {
                     notificationsPanel.style.transform = 'translate(-50%, -50%) scale(0.95)';
                } else if (currentTransform.includes('translateX')) {
                     notificationsPanel.style.transform = currentTransform.replace(/scale\([^)]+\)/g, 'scale(0.95)').replace(/translateY\([^)]+\)/g, 'translateY(-5px)');
                } else {
                     notificationsPanel.style.transform = (currentTransform.replace(/scale\([^)]+\)/g, '').trim() || 'none').replace('none', '') + ' scale(0.95)';
                }
                notificationsPanel.classList.remove('visible');

                if (!document.querySelector('.detalle-nivel-overlay.visible') && 
                    !document.querySelector('#gallery-lightbox.visible') && 
                    !document.querySelector('.logo-overlay.visible')) {
                    body.classList.remove('overlay-active');
                    if (lenis) lenis.start(); 
                }
            }
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape') {
                const visibleGallery = document.querySelector('#gallery-lightbox.visible');
                const visibleNivelOverlay = document.querySelector('.detalle-nivel-overlay.visible');
                const notificationsPanelVisible = notificationsPanel?.classList.contains('visible');

                if (editModeActive) { 
                    togglePanelEditMode();
                } else if (visibleGallery) {
                    closeGalleryLightbox(); 
                } else if (visibleNivelOverlay) {
                    closeNivelOverlay(visibleNivelOverlay.id); 
                } else if (notificationsPanelVisible) {
                    toggleNotificationsPanel(false);
                }
            }
        });
        
        if (notificationsBellContainer) {
            notificationsBellContainer.addEventListener('click', e => { 
                e.stopPropagation(); 
                if (editModeActive) { console.log("Modo de edición de panel activo."); return; }
                toggleNotificationsPanel(); 
            });
            notificationsBellContainer.addEventListener('keydown', e => { 
                if (e.key === 'Enter' || e.key === ' ') { 
                    e.preventDefault(); 
                    if (!editModeActive) toggleNotificationsPanel(); 
                }
            });
        }
        document.addEventListener('click', e => {
            if (notificationsPanel?.classList.contains('visible') && 
                !notificationsPanel.contains(e.target) && 
                notificationsBellContainer && !notificationsBellContainer.contains(e.target) &&
                !editModeActive) { 
                toggleNotificationsPanel(false);
            }
        });
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                initializeAndRunSupabase();
            });
        } else {
            initializeAndRunSupabase();
        }
    </script>
</body>
</html>
